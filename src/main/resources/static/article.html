<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>article</title>
    <script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="js/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="js/easyui-lang-zh_CN.js"></script>
    <link type="text/css" rel="stylesheet" href="css/css.css">
    <link type="text/css" rel="stylesheet" href="css/easyui.css">
    <link type="text/css" rel="stylesheet" href="css/icon.css">
</head>

</head>
<body>
<!--展示数据-->
<table id="showAllArticle">
    <div id="tb1">
        <input name="category" id="ss1" class="easyui-searchbox" style="width:300px"
               data-options="searcher:search,prompt:'所属类别搜索'"></input>
        <input name="editor" id="ss2" class="easyui-searchbox" style="width:300px"
               data-options="searcher:search,prompt:'根据编辑搜索'"></input>
        <input name="title" id="ss3" class="easyui-searchbox" style="width:300px"
               data-options="searcher:search,prompt:'根据标题搜索'"></input>
    </div>

</table>
<script type="text/javascript">
    /*关键词搜索*/
    function search(value,name){
        var cval = $("#ss1").searchbox('getValue');
        var eval = $("#ss2").searchbox('getValue');
        var tval = $("#ss3").searchbox('getValue');

        $('#showAllArticle').datagrid({
            queryParams: {
                category:cval,
                editor:eval,
                title:tval
            }

        });

    }
</script>

<div id="win_add">

</div>

<div id="win_update">

</div>



<!--修改文章-->
<div id="updateArticle" class="easyui-dialog" data-options="closed:true">
    <form id="updateArticleInformation" enctype="multipart/form-data" method="post">

        <input name="navigationId" id="navigationId" type="hidden"><br>
        导航名：<input name="navigationName" id="navigationName"><br>
        Title：<input name="navigationTitle" id="navigationTitle"><br>
        Description：<input name="navigationDescription" id="navigationDescription"><br>
        Keyword：<input name="navigationKeyword" id="navigationKeyword"><br>

        <center>
            <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-save" onClick="pro2()">确认</a>
        </center>
    </form>

</div>
<script type="text/javascript">


    $(function () {

        $('#win_add').window({
            title:"文本编辑器",
            width:600,
            height:400,
            closed:true,
            maximized:true,
            content:"<iframe id=\"myArticleIframe\" src=\"/visney-manager/editor\" width=\"100%\" height=\"100%\"></iframe>",
            onClose:function () {

                $("#showAllArticle").datagrid('reload');
            }
        });

        $('#win_update').window({
            title:"文本编辑器",
            width:600,
            height:400,
            closed:true,
            maximized:true,
            onClose:function () {

                $("#showAllArticle").datagrid('reload');
            }
        });


        $("#showAllArticle")
            .datagrid(
                {
                    url: 'http://localhost:9999/visney-manager/article/getArticles',
                    fitColumns: true,

                    columns: [[{
                        checkbox: true
                    }, {
                        field: 'articleId',
                        align: 'center',
                        title: 'Id',
                        width: 200,

                    },{
                        field: 'articleName',
                        align: 'center',
                        title: '标题',
                        width: 200,

                    },{
                        field: 'articleText',
                        align: 'center',
                        title: '正文',
                        width: 200,
                        formatter:function (value,row,index) {
                            //去除标签，截取50个字符
                            return value.replace(/<\/?.+?>/g,"").substring(0,50)

                        }

                    },{
                        field: 'articleEditor',
                        align: 'center',
                        title: '编辑',
                        width: 200,
                        formatter:function (value,row,index) {

                            return value.articleEditorName

                        }

                    },{
                        field: 'articleImg',
                        align: 'center',
                        title: '封面图片',
                        width: 200,
                        formatter: function (value, row, index) {
                            // value  当前列值
                            // row 当前行对象
                            // index  行数据下标
                            if (value) {

                                return "<img width=50px height=50px src='" + row.articleImg.articleImgSrc + "'>";

                            }

                        }

                    },{
                        field: 'articleCategory',
                        align: 'center',
                        title: '所属类别',
                        width: 200,
                        formatter: function (value, row, index) {
                            // value  当前列值
                            // row 当前行对象
                            // index  行数据下标
                            if (value) {
                                return value.articleCategoryName

                            }

                        }

                    },{
                        field: 'articleRecommend',
                        align: 'center',
                        title: '是否推荐',
                        width: 200,
                        formatter: function (value, row, index) {
                            // value  当前列值
                            // row 当前行对象
                            // index  行数据下标
                            if (value==1) {
                                return "是";

                            }
                            else{
                                return "否";
                            }

                        }

                    },{
                        field: 'labelList',
                        align: 'center',
                        title: '标签',
                        width: 200,
                        formatter:function (value,row,index) {
                            var content="<select>"
                            for(var i=0;i<value.length;i++){
                                content+="<option>"+value[i].articleLabelName+"</option>";
                            }
                            return content+"</select>";

                        }

                    },{
                        field: 'articleMetaDescription',
                        align: 'center',
                        title: 'Description',
                        width: 200,

                    },{
                        field: 'articleMetaTitle',
                        align: 'center',
                        title: 'Title',
                        width: 200,

                    },{
                        field: 'articleKeyWord',
                        align: 'center',
                        title: 'KeyWord',
                        width: 200,

                    },{
                        field: 'pageViews',
                        align: 'center',
                        title: '浏览量',
                        width: 200,
                        formatter: function (value, row, index) {
                            // value  当前列值
                            // row 当前行对象
                            // index  行数据下标
                            if (value) {
                                return value.pageViewsCount

                            }

                        }

                        },{
                        field: 'articleUpdateTime',
                        align: 'center',
                        title: '更新时间',
                        width: 200,

                    },{
                        field: 'articleAddTime',
                        align: 'center',
                        title: '添加时间',
                        width: 200,

                    }
                    ]],
                    striped: true,
                    pagination: true,
                    pageSize:20,
                    /* pageList: [10,20,30,40],*/
                    toolbar: [
                        {
                            iconCls: 'icon-add',
                            handler: function () {
                                $('#win_add').window({
                                    closed:false
                                });
                            }
                        },
                        '-',
                        {
                            iconCls: 'icon-edit',
                            handler: function () {
                                var checks= $("#showAllArticle").datagrid('getChecked');
                                if (checks.length > 1
                                    || checks.length < 1) {
                                    $.messager.alert("消息",
                                        "请选择一条数据修改", 'warning');
                                }else {
                                    var aid= $("#showAllArticle").datagrid('getChecked')[0].articleId;
                                    console.log(aid+"=================")
                                    var src="/visney-manager/editor?id="+aid;

                                var iframe="<iframe id='myArticleIframe' src='";
                                    var append=src+"'"+ "width='100%' height='100%'>"

                                        var result=iframe+append+"</iframe>"

                                 console.log(result)

                                     $('#win_update').window({
                                          closed:false,
                                         content: result,
                                      });

                                }

                            }
                        },
                        '-',
                        {
                            iconCls: 'icon-remove',
                            handler: function () {
                                var cates = $("#showAllArticle").datagrid('getChecked');
                                if (cates.length < 1) {
                                    $.messager.alert("消息", "请选择一条数据修改", 'warning');
                                } else {
                                    $.messager.confirm("消息", "您确定要删除吗？", function (x) {
                                        if (x) {
                                            var articleIds = [];
                                            var pageViewsIds = [];
                                            var articleImgIds = [];

                                            var cateIds = $("#showAllArticle").datagrid('getChecked');
                                            $.each(cateIds, function (index, ii) {
                                                articleIds.push(ii.articleId);
                                                pageViewsIds.push(ii.pageViews.pageViewsId);
                                                articleImgIds.push(ii.articleImg.articleImgId);
                                            })
                                            $.ajax({
                                                type: 'post',
                                                url: 'http://localhost:9999/visney-manager/article/articleDelete',
                                                /*传递数组需要加上这个参数，不然默认在后面加上[]*/
                                                traditional: true,
                                                data: {
                                                    "articleIds":articleIds,
                                                    "pageViewsIds":pageViewsIds,
                                                    "articleImgIds":articleImgIds,
                                                },

                                                success: function (data) {
                                                    if (data != 0) {
                                                        $.messager.alert("消息", "删除成功", 'info');
                                                        $("#showAllArticle").datagrid('reload');
                                                    } else {
                                                        $.messager.alert("消息", "删除失败", 'error');
                                                        $("#showAllArticle").datagrid('reload');
                                                    }
                                                }
                                            })
                                        } else {
                                            $("#showAllArticle").datagrid('reload');
                                        }
                                    })

                                }
                            }

                        },


    ]

                })
    })


    $("#addArticleInformation").submit(function () {
        var formData = new FormData($("#addArticleInformation")[0]);
        $.ajax({
            type: 'post',
            url: 'http://localhost:9999/visney-manager/NavigationMeta/metaAdd',
            data: formData,
            contentType: false,
            processData: false,
            success: function (dada) {
                if (dada == 1) {
                    $.messager.alert("消息", "添加成功", 'info');
                    $("#addArticle").dialog('close');
                    $("#showAllArticle").datagrid('reload');

                } else if (dada == 0) {
                    $.messager.alert("消息", "添加失败", 'error');
                    $("#addArticle").dialog('close');
                    $("#showAllArticle").datagrid('reload');

                }
            }
        })
        return false;
    })
    $("#updateArticleInformation").submit(function () {
        var formData = new FormData($("#updateArticleInformation")[0]);
        $.ajax({
            type: 'post',
            url: 'http://localhost:9999/visney-manager/NavigationMeta/metaUpdate',
            data: formData,
            cache: false,
            contentType: false,
            processData: false,
            success: function (dada) {
                if (dada == 1) {
                    $.messager.alert("消息", "修改成功", 'info');
                    $("#updateArticle").dialog('close');
                    $("#showAllArticle").datagrid('reload');
                } else {
                    $.messager.alert("消息", "修改失败", 'error');
                    $("#updateArticle").dialog('close');
                    $("#showAllArticle").datagrid('reload');
                }
            }
        })
        return false;
    })


    function pro2() {
        $("#updateArticleInformation").submit();
    }

    function pro1() {
        $("#addArticleInformation").submit();
    }
</script>

</body>



</html>