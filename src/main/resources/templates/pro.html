<!DOCTYPE>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>文本编辑器</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <script type="text/javascript" charset="utf-8" th:src="@{ueditor.config.js}"></script>
    <script type="text/javascript" charset="utf-8" th:src="@{ueditor.all.js}"></script>
    <!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
    <!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
    <script type="text/javascript" charset="utf-8" th:src="@{lang/zh-cn/zh-cn.js}"></script>
    <script type="text/javascript" th:src="@{js/jquery-3.3.1.min.js}"></script>
    <style type="text/css">
        div {
            width: 100%;
        }
    </style>

</head>
<html>
<body>
<form id="product_form" enctype="multipart/form-data" method="post">
    产品名：<input name="proName" id="proName" type="text"><br>
    价格：<input name="proPrice" id="proPrice"><br>
    位置： <span id="proPosition"></span><br>
    风格：<span id="proStyle"></span><br>
    类型：<span id="proType"></span><br>
    系列：<span id="proSeries"></span><br>
    材质：<span id="center"></span><br>
    品牌：<span id="brand"></span><br>
    型号：<span id="modleCode"></span><br>
    尺寸：<span id="size"></span><br>
    介绍：<input name="proMsg" id="proMsg"><br>
    浏览量：<input name="pageViews" id="pageViews"><br>
    网店地址：<input name="proSrc" id="proSrc"><br>
    是否上架： <select id="proPutaway">
                <option value="1">是</option>
                <option value="0">否</option>
            </select><br>
    图片：<input name="proImgs" id="proImgs" type="file" onchange="previewImage(this)"><br>
    Keyword：<input name="proMetaKeyWord" id="proMetaKeyWord"><br>
    Description：<input name="proMetaDescription" id="proMetaDescription"><br>
    Title：<input name="proMetaTitle" id="proMetaTitle"><br>

</form>

    <form action="" method="post" id="article-form" enctype="multipart/form-data">
        文章标题：<input type="text" name="articleName" id="article_title">
        文章类别选择：
        <span id="articleCategorySelect"></span>
        文章作者选择：
        <span id="articleEditorSelect"></span>
        文章标签选择：
        <span id="articleLabelSelect1"></span><span id="articleLabelSelect2"></span>
        是否推荐：
        <select id="recommend">
            <option value="1">是</option>
            <option value="0">否</option>
        </select>

        </br>
        <input type="hidden" name="articleText">
        封面图片：<input type="file" onchange="previewImage(this)" name="articleImgSrc" id="article_Img">
        图片alt属性<input type="text" id="img_alt"><br>
        <div id="preview">
            <img id="imghead" border="0" src="img/photo_icon.png" width="90"
                 height="90">
        </div>
        </br>
        meta标签title：<input type="text" id="article_meta_title">
        meta标签description：<input type="text" id="article_meta_description">
        meta标签keyword：<input type="text" id="article_meta_keyword">
    </form>
    <script type="text/javascript">

        /* 展示可供选择的文章类别*/
        $.ajax({
            type: 'get',
            url: 'http://localhost:9999/visney-manager/articleCategory/getAll',
            success: function (value) {
                var content = "<select id=\"category_select\">"
                for (var i = 0; i < value.length; i++) {
                    content += "<option value=" + value[i].articleCategoryId + ">" + value[i].articleCategoryName + "</option>";
                }
                var result = content + "</select>";

                $("#articleCategorySelect").html(result)
            }
        })

        /*展示作者*/
        $.ajax({
            type: 'post',
            url: 'http://localhost:9999/visney-manager/articleEditor/getAllArticleEditor',
            data:{
                page:0,
                rows:0

            },
            success: function (value) {

                var content = "<select id=\"editor_select\">"
                for (var i = 0; i < value.rows.length; i++) {
                    content += "<option value=" + value.rows[i].articleEditorId + ">" + value.rows[i].articleEditorName + "</option>";
                }
                var result = content + "</select>";

                $("#articleEditorSelect").html(result)
            }
        })
        /*展示标签*/
        $.ajax({
            type: 'post',
            url: 'http://localhost:9999/visney-manager/articleLabel/getAllArticleLabel',
            data:{
                page:0,
                rows:0

            },
            success: function (value) {
                var content1 = "<select id=\"label_select1\">"
                var content2 = "<select id=\"label_select2\">"
                for (var i = 0; i < value.rows.length; i++) {
                    content1 += "<option value=" + value.rows[i].articleLabelId + ">" + value.rows[i].articleLabelName + "</option>";
                }
                for (var i = 0; i < value.rows.length; i++) {
                    content2 += "<option value=" + value.rows[i].articleLabelId + ">" + value.rows[i].articleLabelName + "</option>";
                }

                var result1 = content1 + "</select>";
                var result2 = content2 + "</select>";

                $("#articleLabelSelect1").html(result1)
                $("#articleLabelSelect2").html(result2)
            }
        })

        function articleAdd() {
            //选中的文本
            var articleTitle = $("#article_title").val();
            var cid=$('#category_select option:selected').val();
            var eid=$('#editor_select option:selected').val();

            var lname1=$('#label_select1 option:selected').text();
            var lname2=$('#label_select2 option:selected').text();

            var article_recommend=$("#recommend option:selected").val();

            var meta_title= $("#article_meta_title").val();
            var meta_description=$("#article_meta_description").val();
            var meta_keyword=$("#article_meta_keyword").val();

            var articletext=getContent();

            var articleimg=document.getElementById("article_Img").files[0];

            var imgalt = $("#img_alt").val();

            var formdata=new FormData();
            formdata.append("label1",lname1);
            formdata.append("label2",lname2);
            formdata.append("articleName",articleTitle);
            formdata.append("articleText",articletext);
            formdata.append("articleEditor.articleEditorId",eid);
            formdata.append("articleCategory.articleCategoryId",cid);
            formdata.append(" articleRecommend",article_recommend);
            formdata.append("articleMetaDescription",meta_description);
            formdata.append("articleMetaTitle",meta_title);
            formdata.append("articleKeyWord",meta_keyword);
            formdata.append("articleImg.articleImgAlt",imgalt);
            formdata.append("files",articleimg);

            console.log(formdata)


          $.ajax({
                type: 'post',
                url: 'http://localhost:9999/visney-manager/article/articleImgAdd',
                data: formdata,
                processData: false,// 告诉jQuery不要去处理发送的数据
                contentType: false,// 告诉jQuery不要去设置Content-Type请求头
                success: function (data) {
                    if (data==1){
                        alert("添加成功")
                    }
                    else{
                        alert("添加失败")
                    }

                }
            })



        }


    </script>
    <script id="editor" type="text/plain" style="width:1024px;height:500px;"></script>
</div>
<div id="btns">
    <div>
        <button onclick="articleAdd()">确认提交</button>
        <button onclick="getContent()">获得内容</button>
        <button onclick="setContent()">写入内容</button>
        <button onclick="hasContent()">判断是否有内容</button>

    </div>

</div>
<div>

</div>


<script type="text/javascript">

    //实例化编辑器
    //建议使用工厂方法getEditor创建和引用编辑器实例，如果在某个闭包下引用该编辑器，直接调用UE.getEditor('editor')就能拿到相关的实例
    var ue = UE.getEditor('editor');
    /*获得编辑器的内容*/
    function getContent() {
    var text = [];
    /* arr.push("使用editor.getContent()方法可以获得编辑器的内容");*/
    text.push(UE.getEditor('editor').getContent());
     return text;
    }

    function setContent(isAppendTo) {
    var arr = [];
    arr.push("使用editor.setContent('欢迎使用ueditor')方法可以设置编辑器的内容");
    UE.getEditor('editor').setContent('欢迎使用ueditor', isAppendTo);
    alert(arr.join("\n"));
    }

    /* 判断编辑器里是否有内容*/
    function hasContent() {
    var arr = [];
    arr.push("使用editor.hasContents()方法判断编辑器里是否有内容");
    arr.push("判断结果为：");
    arr.push(UE.getEditor('editor').hasContents());
    alert(arr.join("\n"));
    }

    /* 根据文章id编辑文章*/
    function updateArticle() {
    var idd=1;
    $.ajax({
    url:"http://localhost:9999/getArticle",
    type:"post",
    data:'id='+idd,
    dataType:"json",
    async: false,
    success:function(data){
    if(data!=null){
    console.log(data)
    UE.getEditor('editor').addListener("ready", function () {
    // editor准备好之后才可以使用
    UE.getEditor('editor').setContent(data.text);
    /* setContent(data.text)*/

    });


    }
    },
    error:function (data) {
    alert("添加失败")
    }
    });
    }

    // 图片回显
    //添加图片回显
    function previewImage(file) {
    var MAXWIDTH = 90;
    var MAXHEIGHT = 90;
    var div = document.getElementById('preview');
    if (file.files && file.files[0]) {
    div.innerHTML = '<img id=imghead onclick=$("#previewImg").click()>';
    var img = document.getElementById('imghead');
    img.onload = function () {
    var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
    img.width = rect.width;
    img.height = rect.height;
    img.style.marginTop = rect.top + 'px';
    }
    var reader = new FileReader();
    reader.onload = function (evt) {
    img.src = evt.target.result;
    }
    reader.readAsDataURL(file.files[0]);
    }

    }


</script>
</body>
</html>

