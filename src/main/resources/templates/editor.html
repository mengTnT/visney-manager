<!DOCTYPE>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>文本编辑器</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <script type="text/javascript" charset="utf-8" th:src="@{ueditor.config.js}"></script>
    <script type="text/javascript" charset="utf-8" th:src="@{ueditor.all.js}"></script>
    <!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
    <!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
    <script type="text/javascript" charset="utf-8" th:src="@{lang/zh-cn/zh-cn.js}"></script>
    <script type="text/javascript" th:src="@{js/jquery-3.3.1.min.js}"></script>
    <style type="text/css">
        div {
            width: 100%;
        }
    </style>

</head>
<html>
<body>
    <form action="" method="post" id="article-form" enctype="multipart/form-data">
        文章标题：<input type="text" name="articleName">
        文章类别选择：
        <span id="articleCategorySelect"></span>
        文章作者选择：
        <span id="articleEditorSelect"></span>
        文章标签选择：
        <span id="articleLabelSelect1"></span><span id="articleLabelSelect2"></span>

        </br>
        <input type="hidden" name="articleText">
        封面图片：<input type="file" onchange="previewImage(this)" name="articleImgSrc"><br>
        <div id="preview">
            <img id="imghead" border="0" src="img/photo_icon.png" width="90"
                 height="90">
        </div>
        </br>
        <input type="hidden" name="articleCategory.articleCategoryId" id="acid">
        <input type="text" name=""></br>
    </form>
    <script type="text/javascript">

        /* 展示可供选择的文章类别*/
        $.ajax({
            type: 'get',
            url: 'http://localhost:9999/visney-manager/articleCategory/getAll',
            success: function (value) {
                var content = "<select id=\"category_select\">"
                for (var i = 0; i < value.length; i++) {
                    content += "<option value=" + value[i].articleCategoryId + ">" + value[i].articleCategoryName + "</option>";
                }
                var result = content + "</select>";

                $("#articleCategorySelect").html(result)
            }
        })

        /*展示作者*/
        $.ajax({
            type: 'post',
            url: 'http://localhost:9999/visney-manager/articleEditor/getAllArticleEditor',
            data:{
                page:0,
                rows:0

            },
            success: function (value) {
                console.log(value)

                var content = "<select id=\"editor_select\">"
                for (var i = 0; i < value.rows.length; i++) {
                    content += "<option value=" + value.rows[i].articleEditorId + ">" + value.rows[i].articleEditorName + "</option>";
                }
                var result = content + "</select>";

                $("#articleEditorSelect").html(result)
            }
        })
        /*展示标签*/
        $.ajax({
            type: 'post',
            url: 'http://localhost:9999/visney-manager/articleLabel/getAllArticleLabel',
            data:{
                page:0,
                rows:0

            },
            success: function (value) {
                console.log(value)
                var content1 = "<select id=\"label_select1\">"
                var content2 = "<select id=\"label_select2\">"
                for (var i = 0; i < value.rows.length; i++) {
                    content1 += "<option value=" + value.rows[i].articleLabelId + ">" + value.rows[i].articleLabelName + "</option>";
                }
                for (var i = 0; i < value.rows.length; i++) {
                    content2 += "<option value=" + value.rows[i].articleLabelId + ">" + value.rows[i].articleLabelName + "</option>";
                }

                var result1 = content1 + "</select>";
                var result2 = content2 + "</select>";

                $("#articleLabelSelect1").html(result1)
                $("#articleLabelSelect2").html(result2)
            }
        })


    </script>
    <script id="editor" type="text/plain" style="width:1024px;height:500px;"></script>
</div>
<div id="btns">
    <div>

        <button onclick="getContent()">获得内容</button>
        <button onclick="setContent()">写入内容</button>
        <button onclick="hasContent()">判断是否有内容</button>

    </div>

</div>
<div>
    <button onclick="createEditor()">
        创建编辑器
    </button>
    <button onclick="deleteEditor()">
        删除编辑器
    </button>
</div>


<script type="text/javascript">

    //实例化编辑器
    //建议使用工厂方法getEditor创建和引用编辑器实例，如果在某个闭包下引用该编辑器，直接调用UE.getEditor('editor')就能拿到相关的实例
    var ue = UE.getEditor('editor');
    /*获得编辑器的内容*/
    function getContent() {
    var text = [];
    /* arr.push("使用editor.getContent()方法可以获得编辑器的内容");*/
    text.push(UE.getEditor('editor').getContent());
    $.ajax({
    url:"http://localhost:9999/getText",
    type:"post",
    data:'text='+text,
    dataType:"json",
    success:function(data){
    if(data==1){
    alert("添加成功")
    }
    },
    error:function (data) {
    alert("添加失败")
    }
    });
    }

    function setContent(isAppendTo) {
    var arr = [];
    arr.push("使用editor.setContent('欢迎使用ueditor')方法可以设置编辑器的内容");
    UE.getEditor('editor').setContent('欢迎使用ueditor', isAppendTo);
    alert(arr.join("\n"));
    }

    /* 判断编辑器里是否有内容*/
    function hasContent() {
    var arr = [];
    arr.push("使用editor.hasContents()方法判断编辑器里是否有内容");
    arr.push("判断结果为：");
    arr.push(UE.getEditor('editor').hasContents());
    alert(arr.join("\n"));
    }

    /* 根据文章id编辑文章*/
    function updateArticle() {
    var idd=1;
    $.ajax({
    url:"http://localhost:9999/getArticle",
    type:"post",
    data:'id='+idd,
    dataType:"json",
    async: false,
    success:function(data){
    if(data!=null){
    console.log(data)
    UE.getEditor('editor').addListener("ready", function () {
    // editor准备好之后才可以使用
    UE.getEditor('editor').setContent(data.text);
    /* setContent(data.text)*/

    });


    }
    },
    error:function (data) {
    alert("添加失败")
    }
    });
    }

    // 图片回显
    //添加图片回显
    function previewImage(file) {
    var MAXWIDTH = 90;
    var MAXHEIGHT = 90;
    var div = document.getElementById('preview');
    if (file.files && file.files[0]) {
    div.innerHTML = '<img id=imghead onclick=$("#previewImg").click()>';
    var img = document.getElementById('imghead');
    img.onload = function () {
    var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
    img.width = rect.width;
    img.height = rect.height;
    img.style.marginTop = rect.top + 'px';
    }
    var reader = new FileReader();
    reader.onload = function (evt) {
    img.src = evt.target.result;
    }
    reader.readAsDataURL(file.files[0]);
    }

    }


</script>
</body>
</html>

